# Ветки - главная фишка git

Git стал стандартом в системах контроля версий благодаря простой и удобной работе с ветками.

**Какие проблемы решают ветки**

Представим рабочую ситуацию. Мы сидим и разрабатываем функционал новой большой фичи, например, добавляем на сайт раздел новостей. Уже добавили новые файлы, поменяли стили, поправили разметку, но до завершения еще далеко.

Внезапно прилетает задача - срочно поправить багу в верстке шапки. Мы не можем чинить багу прямо сейчас, в текущем состоянии проекта. У нас много изменений, но работа над большой фичей не завершена - поэтому мешать код новой фичи и код с починкой срочной баги нельзя. Как быть?

Было бы здорово, если бы могли разрабатывать новую фичу независимо от основного кода проекта. То есть взять и зафиксировать рабочее состояние сайта, а делать новый функционал отдельно, не боясь поломать рабочий код. И еще чтобы можно было переключаться между основным кодом (для правки баги) и кодом новой фичи (для продолжения работы над ней)

Если не пользоваться  git, то решается эта проблемма созданием архивов проекта. Довел сайт до какого-то рабочего состояния - сделал архив. Реализовал новую фичу - сделал еще один архив. Нужно переключиться на старый код для правки баги - сохранил текущую работу в новый "временный" архив, выбрал старый "стабильный" архив, распаковал, починил там багу, вернулся обратно во "временный" архив.

_**Схема рабочая, но слишком много суеты и неудобств:**_

•	нужно постоянно создавать архивы с рабочим кодом

•	сложно "переключаться" между архивами

•	сложно перетаскивать изменения между архивами

•	легко что-то напутать или потерять - все мы люди

Все эти проблемы git решает механизмом веток.

>Как работают ветки

Представим код проекта в виде дерева. Посередине ствол - это рабочее состояние проекта, тот код, который выложен на боевом сервере. Этот ствол в терминах git называется основной веткой разработки - веткой master. Эта ветка есть всегда в любом проекте. Как только мы клонировали или создали новый репозиторий, мы попали в ветку master. Все, что мы делали на предыдущих уроках, мы делали в мастере.

Когда мы начинаем работать над новым функционалом, мы создаем новую ветку на основе master. Это называется "ответвиться от мастера". После этого мы можем работать, создавать новые файлы, вносить изменения в старые, можем хоть удалить половину проекта - главное, что это будет изолировано от основного мастера. То есть в своей ветке мы можем как угодно ломать проект, основной код при этом не пострадает.

Кроме того мы в любой момент можем переключиться в мастер, например, для правки баги, не боясь потерять изменения в своей ветке с новым функционалом. Починим багу в мастере, выложим правку на боевой сайт и так же легко вернемся к своей ветке и продолжим работать в ней.

Так как git хранит всю историю проекта, то он хранит все коммиты всех веток и со всеми изменениями. То есть вернувшись в свою ветку мы увидим уже сделанные коммиты и можем посмотреть изменения по ним.
Когда мы заканчиваем работать над новым функционалом, то нужно наши изменения перенести в мастер, чтобы залить на боевой сайт. Это называется слить ветку в мастер, или залить в мастер, или смерджить в мастер. При этом после мерджа в мастере оказываются не только наши изменения, но и те, которые были в мастере, но не были в нашей ветке (правка баги в мастере). То есть нам даже не обязательно после правки баги в мастере переносить эти изменения в свою ветку. При мердже git наш новый код "положит" поверх того, что было в мастере, не стирая старый.

## _Ветка master_

Еще раз закрепим. Ветка master - это, как правило, основная ветка проекта. Она появляется сразу после клонирования или инициализации репозитория. Есть разные варианты ведения веток, но мы будем считать, что master - наша основная рабочая ветка, от которой ответвляются другие.
Как создать новую ветку

```
git checkout -b news
```

Так мы создали новую ветку news, имея в виду, что будем разрабатывать в ней блок новостей.

Как переключаться между ветками
Для этого используется команда checkout

```
git checkout news 
```

Обратите внимание, если у вас есть незакоммиченные изменения, то переключиться на другую ветку не получится - git за этим следит
Вот что при этом вы увидите 

```
    git checkout master 
    error: Your local changes to the following files would be overwritten by checkout:
            index.html
    Please, commit your changes or stash them before you can switch branches.
    Aborting
```

Поэтому сначала или закоммитьте изменения в ветке, или откатите эти изменения - а уже потом переключайтесь. Это может показаться странным, но так сделано для безопасности, чтобы случайно не потерять код.

_Как посмотреть все ветки_

```
git branch
master
* news
```

Этой командой мы выведем список всех локальных веток. Звездочка у news означает текущую ветку, в которой мы сейчас находимся.

_Коммитим в новую ветку_

Коммиты в ветку добавляются точно так же, как и раньше. Делаем изменения в файлах, потом **git add**, потом **git commit -m 'commit message'**.

_Как запушить новую ветку_

Вспомним, как мы пушили раньше

```
git push origin master
```

Точно так же мы пушим и новую ветку, только вместо master указываем свое название

```
git push origin news
```

Если такой ветки на сервере нет, то она создастся. Если мы ее уже пушили раньше, то просто отправятся новые коммиты.

_Как переименовать ветку_

Допустим, мы неудачно выбрали название и хотим его заменить. Находясь в нужной ветке, выполним команды

```
git branch -m block-news
```

Это переименует текущую ветку news в block-news. Чтобы убедиться, посмотрим список веток

```
git branch 
* block-news
master
```

Обратите внимание, если мы запушим новую ветку, то на сервере, в github, появится еще одна ветка block-news, и при этом останется старая news. Чтобы не засорять проект, старую ветку нужно удалить как локальную у себя, так и удаленную на сервере.

_Как удалить ветку_

Удаляется ветка командой git branch -d branch_name. Но здесь могут быть варианты. Рассмотрим, что может пойти не так

```
git branch -d block-news  
error: Cannot delete the branch 'block-news' which you are currently on.
```

Здесь просто - мы не можем удалить ветку, потому что в ней находимся. Сначала нужно перелючиться в мастер

```
git checkout master 
git branch -d block-news 
error: The branch 'block-news' is not fully merged.
If you are sure you want to delete it, run 'git branch -D block-news'.
```

Опять ошибка - здесь git говорит о том, что в удаляемой ветке есть код, который не залит в мастер. То есть при удалении ветки этот код потеряется. Поэтому если мы уверены в своих действиях и ветка действительно не нужна, то вместо флага -d нужен -D 

```
git branch -D block-news 
Deleted branch block-news (was cb38a55).
```

Теперь удалено без вопросов.

# _**Что могу посоветовать**_

•	научитесь легко оперировать ветками

•	создавайте больше веток

•	называйте ветки по общим правилам

•	пушьте ветки почаще, их легко потом удалить

Поняв магию веток, мы уже не представим свою работу без git. Любой, даже небольшой проект мы будем начинать с создания репозитория. А работа с ветками будет такой же естественной, как и собственно написание кода. Мне кажется, именно понимание веток превращает git из прикольной тулзы в незаменимый инструмент работы.



[<Назад](./../Pages/deff.md)  [<Главная>](./../readme.md)